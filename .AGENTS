# Codex Reviewer GitHub Action 요약

이 저장소는 PR에 라벨이 붙었을 때 OpenAI Codex를 실행해 코드 리뷰 코멘트를 자동으로 남기는 GitHub Action(컴포지트 액션)이다.

## 핵심 흐름
1) Node.js 18 설치
2) `@openai/codex` 최신 버전 전역 설치
3) PR의 base/head 브랜치를 fetch 후 diff 생성(`pr.diff`)
4) `prompt.txt`(또는 `custom_prompt`)를 준비하고 `LANGUAGE` 치환
5) `codex` 실행 → `review.md` 생성
6) `review.md`를 PR 코멘트로 게시

## 입력 값(action.yml 기준)
- `github_token` (필수): PR 코멘트 작성용 토큰
- `openai_api_key` (필수): OpenAI API 키
- `label` (필수, 기본 `codex-review`): 리뷰 트리거 라벨
- `model` (선택, 기본 `o4-mini`): Codex 모델
- `language` (선택, 기본 `english`): 리뷰 언어
- `custom_prompt` (선택): 기본 프롬프트 대신 사용

## 생성/사용 파일
- `prompt.txt`: 기본 리뷰 프롬프트(액션 디렉터리에서 복사)
- `pr.diff`: base...head PR diff
- `review.md`: Codex 리뷰 결과(없으면 기본 메시지 생성)

## 동작 조건/권한
- PR 이벤트 컨텍스트에서 동작해야 함 (`github.event.pull_request.*` 사용)
- 워크플로우 권한: `contents: read`, `pull-requests: write`, `issues: write` 권장

## 프롬프트 규칙(요약)
- `review.md`에 LANGUAGE로 리뷰 작성
- 새 hunk의 라인 번호 범위 내에서만 코멘트
- 코드 블록은 적절한 언어 식별자 사용
- 수정 제안은 `diff` 코드블록으로 작성(라인 범위 일치)
- `suggestion` 코드블록 사용 금지

## 변경 시 유의점
- `prompt.txt` 변경 시 `LANGUAGE` 치환 규칙 유지 필요
- `sed -i`는 GNU sed 기준이며, 액션은 `ubuntu-latest`에서 동작
- `codex`가 실패하면 기본 메시지로 대체됨(빈 리뷰 방지)

## 관련 파일
- `action.yml`: 액션 정의(입력/스텝)
- `prompt.txt`: 기본 프롬프트 템플릿
- `README.md`: 사용 방법
